;/*FB_PKG_DELIM*/

__d("E2EEBackupSecretRegisterModule",["E2EEBackupCommon","QuickPerformanceLogger","Random","VestaClient","VestaClientError","VestaClientV2","getErrorSafe","gkx","qpl"],(function(t,n,r,o,a,i,l){"use strict";var e,s=r("qpl")._(235865454,"167");function u(){return o("Random").uint32()}function c(t,n,o){var a=u();return(e||(e=r("QuickPerformanceLogger"))).markerStart(s,a),e.markerAnnotate(s,{string:{product_use_case:n.productUseCase,registration_mode:"regular_mode"}},{instanceKey:a}),m(t,n,!1,o,a)}function d(t,n,o){var a=u();return(e||(e=r("QuickPerformanceLogger"))).markerStart(s,a),e.markerAnnotate(s,{string:{product_use_case:n.productUseCase,registration_mode:"re-register_mode"}},{instanceKey:a}),m(t,n,!0,o,a)}async function m(t,n,a,i,l){try{var u=r("gkx")("13570");(e||(e=r("QuickPerformanceLogger"))).markerAnnotate(s,{bool:{is_wasm_vesta_client_v2:u}},{instanceKey:l});var c=await t.initRegister({clientId:n.clientId,productUseCase:n.productUseCase},i),d=c.isRegistered,m=c.islandEd25519Pub,p=c.islandEd25519PubSig,_=c.islandRsaPub,f=c.islandRsaPubSig;if(e.markerPoint(s,"init_register_network_end",{instanceKey:l}),d&&!a)throw(e||(e=r("QuickPerformanceLogger"))).markerAnnotate(s,{string:{failure_reason:"ALREADY_REGISTERED"}},{instanceKey:l}),e.markerEnd(s,3376,l),new(o("E2EEBackupCommon")).BackupError(o("E2EEBackupCommon").BackupErrorType.ALREADY_REGISTERED);var g,h;if(u){var y=await Promise.all([o("VestaClientV2").validateHsmKey(_,f),o("VestaClientV2").validateHsmKey(m,p)]);if(g=y[0],h=y[1],!g.success)throw g.error;if(!h.success)throw h.error;g=g.value,h=h.value}else{var C=await Promise.all([o("VestaClient").validateHsmKey(_,f),o("VestaClient").validateHsmKey(m,p)]);g=C[0],h=C[1]}if(!g)throw(e||(e=r("QuickPerformanceLogger"))).markerAnnotate(s,{string:{failure_reason:"ISLAND_PUB_RSA_KEY_INVALID"}},{instanceKey:l}),e.markerEnd(s,3,l),new(o("E2EEBackupCommon")).BackupError(o("E2EEBackupCommon").BackupErrorType.ISLAND_PUB_RSA_KEY_INVALID);if(!h)throw(e||(e=r("QuickPerformanceLogger"))).markerAnnotate(s,{string:{failure_reason:"ISLAND_PUB_ED25519_KEY_INVALID"}},{instanceKey:l}),e.markerEnd(s,3,l),new(o("E2EEBackupCommon")).BackupError(o("E2EEBackupCommon").BackupErrorType.ISLAND_PUB_ED25519_KEY_INVALID);e.markerPoint(s,"validate_hsm_keys_client_end",{instanceKey:l});var b=n.vestaAccountPin;if(b==null)throw new(o("E2EEBackupCommon")).BackupError(o("E2EEBackupCommon").BackupErrorType.MISSING_PIN_INPUT);var v=new TextEncoder,S;if(u){if(S=await o("VestaClientV2").beginRegister(v.encode(b)),!S.success)throw S.error;S=S.value}else S=await o("VestaClient").beginRegister(v.encode(b));var R=S,L=R.clientState,E=R.r1Message;(e||(e=r("QuickPerformanceLogger"))).markerPoint(s,"begin_register_client_end",{instanceKey:l});var k=await t.beginRegister({clientId:n.clientId,productUseCase:n.productUseCase,opaqueR1:E},i),I=k.opaqueChallenge,T=k.opaqueR2,D=k.opaqueR2Sig;e.markerPoint(s,"begin_register_network_end",{instanceKey:l});var x;if(u){if(x=await o("VestaClientV2").finishRegister(E,T,D,m,L,n.secret,I,_),!x.success)throw x.error;x=x.value}else x=await o("VestaClient").finishRegister(E,T,D,m,L,n.secret,I,_);var $=x,P=$.registerPayload;e.markerPoint(s,"finish_register_client_end",{instanceKey:l});var N=await t.finishRegister({clientId:n.clientId,productUseCase:n.productUseCase,encRegPayload:P},i),M=N.registerSuccess;if(e.markerPoint(s,"finish_register_network_end",{instanceKey:l}),!M)throw(e||(e=r("QuickPerformanceLogger"))).markerAnnotate(s,{string:{failure_reason:"VESTA_SERVER_ERROR"}},{instanceKey:l}),e.markerEnd(s,3,l),new(o("E2EEBackupCommon")).BackupError(o("E2EEBackupCommon").BackupErrorType.VESTA_SERVER_ERROR);e.markerEnd(s,2,l)}catch(t){if(t instanceof o("E2EEBackupCommon").BackupError)throw t;if(t instanceof r("VestaClientError")){var w=r("getErrorSafe")(t);throw(e||(e=r("QuickPerformanceLogger"))).markerAnnotate(s,{string:{failure_reason:"VestaClientException: "+w.name}},{instanceKey:l}),e.markerEnd(s,3,l),new(o("E2EEBackupCommon")).BackupError(o("E2EEBackupCommon").BackupErrorType.VESTA_CLIENT_ERROR,w)}else{var A=r("getErrorSafe")(t);throw(e||(e=r("QuickPerformanceLogger"))).markerAnnotate(s,{string:{failure_reason:A.message}},{instanceKey:l}),e.markerEnd(s,3,l),new(o("E2EEBackupCommon")).BackupError(o("E2EEBackupCommon").BackupErrorType.NETWORK_PROVIDER_ERROR,A)}}}l.registerBackupSecret=c,l.reRegisterBackupSecret=d}),98);
__d("FBIconArrowsCircleFilled12.svg.react",["XPlatReactSVG","react"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){return s.jsxs(o("XPlatReactSVG").Svg,babelHelpers.extends({viewBox:"0 0 12 13",width:"1em",height:"1em",fill:"currentColor",title:e.title},e,{children:[e.children!=null&&s.jsx(o("XPlatReactSVG").Defs,{children:e.children}),s.jsx(o("XPlatReactSVG").G,{fillRule:"evenodd",transform:"translate(-450 -1073)",children:s.jsxs(o("XPlatReactSVG").G,{fillRule:"nonzero",children:[s.jsx(o("XPlatReactSVG").Path,{d:"M99.582 923.359a4.496 4.496 0 0 1-.082-.86 4.485 4.485 0 0 1 1.318-3.181A4.483 4.483 0 0 1 104 918a4.485 4.485 0 0 1 2.886 1.046.75.75 0 1 0 .96-1.151A5.986 5.986 0 0 0 104 916.5a5.983 5.983 0 0 0-4.242 1.757A5.985 5.985 0 0 0 98 922.5c0 .389.037.772.11 1.145a.75.75 0 0 0 1.472-.286zm8.836-1.718a4.485 4.485 0 0 1-1.236 4.041A4.483 4.483 0 0 1 104 927a4.485 4.485 0 0 1-2.884-1.046.75.75 0 1 0-.963 1.15A5.986 5.986 0 0 0 104 928.5a5.983 5.983 0 0 0 4.244-1.756A5.985 5.985 0 0 0 110 922.5c0-.389-.037-.772-.11-1.145a.75.75 0 0 0-1.472.286z",transform:"translate(352 157)"}),s.jsx(o("XPlatReactSVG").Path,{d:"M107 918.5h-1.25a.75.75 0 1 0 0 1.5h2a.75.75 0 0 0 .75-.75v-2a.75.75 0 1 0-1.5 0v1.25zm-6 8h1.25a.75.75 0 1 0 0-1.5h-2a.75.75 0 0 0-.75.75v2a.75.75 0 1 0 1.5 0v-1.25z",transform:"translate(352 157)"})]})})]}))}u.displayName=u.name+" [from "+i.id+"]",u._isSVG=!0;var c=u;l.default=c}),98);
__d("FBNucleusArrowsCircleFilled16Icon.react",["react"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){return s.jsxs("svg",babelHelpers.extends({viewBox:"0 0 16 16",width:"1em",height:"1em",fill:"currentColor"},e,{children:[e.title!=null&&s.jsx("title",{children:e.title}),e.children!=null&&s.jsx("defs",{children:e.children}),s.jsx("path",{d:"M13.715 8.64a5.751 5.751 0 0 1-9.32 3.84l.521-.523a1 1 0 0 0-.707-1.707H2.042c-.736 0-1.333.597-1.333 1.333v2.167a1 1 0 0 0 1.707.707l.558-.558a7.751 7.751 0 0 0 12.729-5.04 1 1 0 1 0-1.988-.219zM.297 7.14a1 1 0 1 0 1.988.22 5.751 5.751 0 0 1 9.298-3.857l-.54.54a1 1 0 0 0 .707 1.707h2.167c.736 0 1.333-.597 1.333-1.333V2.25a1 1 0 0 0-1.707-.707l-.539.539A7.751 7.751 0 0 0 .297 7.14z"})]}))}u.displayName=u.name+" [from "+i.id+"]",u._size=16,u._isSVG=!0;var c=u;l.default=c}),98);
__d("LSEncryptedBackupsCreateVirtualDeviceActionType",[],(function(t,n,r,o,a,i){var e=Object.freeze({INSERT:1,UNIQUE_VD_TYPE_INSERT:2});i.default=e}),66);
__d("MAWEncryptedBackupsInitializeBackupDeferred",["EBSMAPI","I64","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","QPLUserFlow","getErrorSafe","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.isAutoEBFlow,a=n===void 0?!1:n,i=t.onBackupCreationSuccess,l=t.onFailure,s=t.onStart,u=t.qplEventName,c=u===void 0?o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent:u,d=t.instanceKey,m=t.virtualDeviceType,p=t.virtualDeviceId;s==null||s(),a?r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"AUTO_EB_CREATION_START"):r("QPLUserFlow").addPoint(c,"SETUP_INITIALIZE_BACKUP_SPROC_START",{instanceKey:d}),p!=null&&r("QPLUserFlow").addAnnotations(c,{int:{virtualDeviceType:(e||(e=o("I64"))).to_int32(m)},string:{virtualDeviceId:p}}),r("promiseDone")(r("EBSMAPI").initializeBackup({virtualDeviceId:p,virtualDeviceType:m}),function(t){t.success?(a?(r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"AUTO_EB_CREATION_SUCCESS"),o("MWChatEncryptedBackupsLogging").endSuccess({annotations:{string:{setup_type:"auto_eb"}},event:o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,instanceKey:d})):(r("QPLUserFlow").addPoint(c,"SETUP_INITIALIZE_BACKUP_SPROC_END",{instanceKey:d}),r("QPLUserFlow").addPoint(c,"SETUP_INITIALIZE_BACKUP_END",{instanceKey:d})),i==null||i()):(r("QPLUserFlow").markError(c,"SETUP_INITIALIZE_BACKUP_SPROC_FAILURE_RESOLVE",{instanceKey:d}),r("QPLUserFlow").addAnnotations(c,{int:{virtualDeviceType:(e||(e=o("I64"))).to_int32(m)},string:{resolve_error_reason:t.error}},{instanceKey:d}),a&&(r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"AUTO_EB_CREATION_FAIL"),o("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorReason:t.error,setup_type:"auto_eb"}},errorName:t.error,event:o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,instanceKey:d})),l())},function(t){r("QPLUserFlow").markError(c,"SETUP_INITIALIZE_BACKUP_SPROC_FAILURE_REJECT",{instanceKey:d});var n=r("getErrorSafe")(t);r("QPLUserFlow").addAnnotations(c,{int:{virtualDeviceType:(e||(e=o("I64"))).to_int32(m)},string:{reject_error_reason:n.message}},{instanceKey:d}),a&&(r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"AUTO_EB_CREATION_FAIL"),o("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorReason:n.message,setup_type:"auto_eb"}},errorName:n.name,event:o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,instanceKey:d})),l()})}l.initializeBackupDeferred=s}),98);
__d("MWChatEncryptedBackupsPinCodeConfirmStepContentWrapper.react",["MWChatEncryptedBackupsNumericCodeErrorWrapper.react","MWChatEncryptedBackupsNumericCodeInput.react","react","react-compiler-runtime"],(function(t,n,r,o,a,i,l){"use strict";var e=["error","inputSize","isMessenger"],s,u=s||(s=o("react"));function c(t){var n=o("react-compiler-runtime").c(11),a,i,l;if(n[0]!==t){var s=t.error,c=t.inputSize,d=t.isMessenger,m=babelHelpers.objectWithoutPropertiesLoose(t,e);a=s,l=c,i=m,n[0]=t,n[1]=a,n[2]=i,n[3]=l}else a=n[1],i=n[2],l=n[3];var p=l===void 0?"large":l,_;n[4]!==i||n[5]!==p?(_=u.jsx(r("MWChatEncryptedBackupsNumericCodeInput.react"),babelHelpers.extends({testid:void 0},i,{inputSize:p})),n[4]=i,n[5]=p,n[6]=_):_=n[6];var f;return n[7]!==a||n[8]!==p||n[9]!==_?(f=u.jsx(r("MWChatEncryptedBackupsNumericCodeErrorWrapper.react"),{error:a,inputSize:p,children:_}),n[7]=a,n[8]=p,n[9]=_,n[10]=f):f=n[10],f}l.default=c}),98);
__d("MWEBPinCodeSetupResult",["$InternalEnum"],(function(t,n,r,o,a,i){"use strict";var e=n("$InternalEnum").Mirrored(["SUCCESS","LABYRINTH_ERROR","VESTA_ERROR","DELETE_MAILBOX_ERROR"]);i.CodeSetupResult=e}),66);
__d("MWXIconRefresh",["MWXSvgIcon","SVGIcon","cr:22458","gkx"],(function(t,n,r,o,a,i,l){"use strict";var e=o("MWXSvgIcon").mwxSvgIcon(o("SVGIcon").svgIcon(n("cr:22458")),r("gkx")("23219"));l.default=e}),98);
__d("MessengerCheckmark.svg.react",["react"],(function(t,n,r,o,a,i,l){"use strict";var e,s=e||(e=o("react"));function u(e){return s.jsxs("svg",babelHelpers.extends({viewBox:"0 0 36 36",width:"1em",height:"1em",fill:"currentColor"},e,{children:[e.title!=null&&s.jsx("title",{children:e.title}),e.children!=null&&s.jsx("defs",{children:e.children}),s.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M26.378 9.169c.597.347.8 1.112.453 1.709l-9 15.5a1.25 1.25 0 0 1-1.965.256l-6.5-6.5a1.25 1.25 0 1 1 1.768-1.768l5.121 5.121a.25.25 0 0 0 .393-.05L24.67 9.621a1.25 1.25 0 0 1 1.709-.453z"})]}))}u.displayName=u.name+" [from "+i.id+"]",u._isSVG=!0;var c=u;l.default=c}),98);
__d("MWEncryptedBackupsCreateExtraVirtualDeviceDeferred",["EBSMAPI","LSEncryptedBackupsCreateVirtualDeviceActionType"],(function(t,n,r,o,a,i,l){"use strict";function e(e){var t=e.actionType,n=t===void 0?r("LSEncryptedBackupsCreateVirtualDeviceActionType").INSERT:t,o=e.onFailure,a=e.onSuccess;r("EBSMAPI").addVirtualDevice({actionType:n}).then(function(e){e.success?a():o()})}l.encryptedBackupsCreateExtraVirtualDeviceDeferred=e}),98);
__d("MWEncryptedBackupsGenerateRecoveryCode",["Base64Utils","I64","LSFactory","LSGenerateRecoveryCodeStoredProcedure"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var n=t.db,a=t.virtualDeviceType;return n.runInTransaction(function(t){return r("LSGenerateRecoveryCodeStoredProcedure")(r("LSFactory")(t),{virtualDeviceType:(e||(e=o("I64"))).of_int32(a)})},"readwrite",void 0,void 0,i.id+":31").then(function(e){var t=e[0],n=e[1],r=e[2];return{recoveryCode:t,sprocResult:n,virtualDeviceId:r!=null?o("Base64Utils").fromArrayBuffer(r):void 0}})}l.encryptedBackupsGenerateRecoveryCode=s}),98);
__d("VestaBackupSecretRegister",["requireDeferred"],(function(t,n,r,o,a,i,l){"use strict";var e=r("requireDeferred")("E2EEBackupSecretRegisterModule").__setRef("VestaBackupSecretRegister"),s=r("requireDeferred")("VestaServerGraphQLRegisterProvider").__setRef("VestaBackupSecretRegister");async function u(t){var n=t.isAlreadyRegistered,r=n===void 0?!1:n,o=t.environment,a=t.input,i=await Promise.all([s.load(),e.load()]),l=i[0],u=l.beginRegister,c=l.finishRegister,d=l.initRegister,m=i[1],p=m.registerBackupSecret,_=m.reRegisterBackupSecret,f=[{beginRegister:u,finishRegister:c,initRegister:d},a,{environment:o}];return r?_.apply(void 0,f):p.apply(void 0,f)}l.vestaBackupSecretRegister=u}),98);
__d("useCreateEncryptedBackup",["CometRelay","FBLogger","I64","LSIntEnum","MAWEncryptedBackupsInitializeBackupDeferred","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEBODSEntityName.enum","MWEncryptedBackupsCreateExtraVirtualDeviceDeferred","MWEncryptedBackupsGenerateRecoveryCode","MWEncryptedBackupsLocalStorageEntryEnum","QPLUserFlow","VestaBackupSecretRegister","getErrorSafe","gkx","promiseDone","requireDeferred","useLabyrinthLogging","useMWEBFlowSourceContext","useReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u,c=r("requireDeferred")("MWEncryptedBackupsSharedState").__setRef("useCreateEncryptedBackup"),d=r("requireDeferred")("VestaDeleteAccount").__setRef("useCreateEncryptedBackup");function m(t){var n=t.backupExists,a=t.onInit,i=t.onLabyrinthError,l=t.onSuccess,m=t.onVestaError,p=(u||(u=r("useReStore")))(),_=o("useLabyrinthLogging").useLabyrinthLoggingFlow(),f=_.startFlow,g=r("useMWEBFlowSourceContext")(),h=o("CometRelay").useRelayEnvironment(),y=async function(n,a,i,l){try{return r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_INIT_BACKUP_START"),l!=null&&r("QPLUserFlow").addAnnotations(o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,{int:{virtualDeviceType:(e||(e=o("I64"))).to_int32(i)},string:{virtualDeviceId:l}}),await new Promise(function(e,t){return o("MAWEncryptedBackupsInitializeBackupDeferred").initializeBackupDeferred({instanceKey:a,onBackupCreationSuccess:function(){return e()},onFailure:function(){return t()},qplEventName:n,virtualDeviceId:l,virtualDeviceType:i})}),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_INIT_BACKUP_END"),r("QPLUserFlow").addPoint(n,"success_backup_initialization",{instanceKey:a}),!0}catch(e){var t=r("getErrorSafe")(e);r("QPLUserFlow").markError(o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_INIT_BACKUP_FAILURE"),r("QPLUserFlow").markError(n,"failed_backup_initialization",{instanceKey:a}),r("FBLogger")("wmi_eb").catching(t).mustfix("[labyrinth][onboarding] Error when initializing backup on device using PIN")}return!1},C=async function(t,n){try{return await new Promise(function(e,t){return o("MWEncryptedBackupsCreateExtraVirtualDeviceDeferred").encryptedBackupsCreateExtraVirtualDeviceDeferred({db:p,onFailure:t,onSuccess:e})}),r("QPLUserFlow").addPoint(t,"success_device_verification",{instanceKey:n}),!0}catch(o){var e=r("getErrorSafe")(o);r("QPLUserFlow").markError(t,"failed_device_verification",{instanceKey:n}),r("FBLogger")("wmi_eb").catching(e).mustfix("Error when creating extra virtual device with PIN")}return!1};return async function(e,t,u){t===void 0&&(t=o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent),a==null||a(),r("QPLUserFlow").addAnnotations(t,{string:{source:g()}},{instanceKey:u});var _;try{f({event:o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH}),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_RECOVERY_CODE_GENERATE_START"),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"SETUP_RECOVERY_CODE_GENERATE_START");var b=2,v=await o("MWEncryptedBackupsGenerateRecoveryCode").encryptedBackupsGenerateRecoveryCode({db:p,virtualDeviceType:b}),S=v.recoveryCode,R=v.virtualDeviceId;if(_=R,S==null||R==null){r("FBLogger")("wmi_eb").mustfix("Cannot setup a PIN Code without a recovery code"),r("QPLUserFlow").markError(t,"SETUP_RECOVERY_CODE_GENERATE_FAILURE",{instanceKey:u}),o("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorReason:"ONBOARDING_RECOVERY_CODE_GENERATE_FAILURE",setup_type:"pin_code"}},errorName:"ONBOARDING_RECOVERY_CODE_GENERATE_FAILURE",event:o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH}),i==null||i();return}var L=new TextEncoder;r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_SAP_VESTA_REGISTRATION_START"),r("QPLUserFlow").addPoint(t,"SETUP_SAP_VESTA_REGISTRATION_START",{instanceKey:u}),await o("VestaBackupSecretRegister").vestaBackupSecretRegister({environment:h,input:{clientId:R,productUseCase:r("gkx")("24066")?"IGD_ENC_BACKUP":"MSGR_ENC_BACKUP",secret:L.encode(S),vestaAccountPin:e}}),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_SAP_VESTA_REGISTRATION_END"),r("QPLUserFlow").addPoint(t,"SETUP_SAP_VESTA_REGISTRATION_END",{instanceKey:u});var E=n?await C(t,u):await y(t,u,(s||(s=o("LSIntEnum"))).ofNumber(b),R);if(E)c.onReady(function(e){var t=e.upsertEBSharedStateEntry;r("promiseDone")(t({db:p,stateKey:r("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_ONBOARDED_SUCCESSFULLY}))}),l&&l(),o("MWChatEncryptedBackupsLogging").endSuccess({event:o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH}),o("MWChatEncryptedBackupsLogging").endSuccess({annotations:{string:{setup_type:"pin_code"}},event:t,instanceKey:u});else{r("QPLUserFlow").markError(t,"pin_code_create_vd_error",{instanceKey:u}),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_DELETE_VESTA_ACCOUNT_START");var k=await d.load(),I=k.vestaDeleteAccount;I({clientId:R,environment:h,productUseCase:"MSGR_ENC_BACKUP",updater:function(t){var e,n=(e=t.getRootField("fbid_based_auth_layer_vesta_delete_account"))==null?void 0:e.getLinkedRecord("vesta_user_info");if(n!=null){var r;(r=t.getRoot())==null||(r=r.getLinkedRecord("viewer"))==null||(r=r.getLinkedRecord("messenger_default_encrypted_backup"))==null||(r=r.getLinkedRecord("vesta_user_info"))==null||r.copyFieldsFrom(n)}}}),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_DELETE_VESTA_ACCOUNT_END"),o("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorReason:"ONBOARDING_VIRTUAL_DEVICE_CREATE_FAILURE",setup_type:"pin_code"}},errorName:"ONBOARDING_RECOVERY_CODE_GENERATE_FAILURE",event:o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH}),i==null||i()}}catch(e){var T=r("getErrorSafe")(e);if(_!=null){var D=await d.load(),x=D.vestaDeleteAccount;x({clientId:_,environment:h,productUseCase:"MSGR_ENC_BACKUP",updater:function(t){var e,n=(e=t.getRootField("fbid_based_auth_layer_vesta_delete_account"))==null?void 0:e.getLinkedRecord("vesta_user_info");if(n!=null){var r;(r=t.getRoot())==null||(r=r.getLinkedRecord("viewer"))==null||(r=r.getLinkedRecord("messenger_default_encrypted_backup"))==null||(r=r.getLinkedRecord("vesta_user_info"))==null||r.copyFieldsFrom(n)}}})}r("QPLUserFlow").markError(t,"pin_code_vesta_error",{instanceKey:u}),o("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorReason:T.toString(),setup_type:"pin_code"}},errorName:"ONBOARDING_UNKNOWN_FAILURE",event:o("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:r("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH}),m==null||m(),r("FBLogger")("wmi_eb").catching(T).mustfix("[labyrinth][onboarding] Error when setting the pin code up")}}}l.default=m}),98);
__d("useMWChatEncryptedBackupsOnPinCodeSetup",["fbt","BaseToasterStateManager","FDSCheckmarkCircleFilled24Icon","FDSIcon.react","MWChatEncryptedBackupsQPLEvents","MWEBPinCodeSetupResult","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","MWXIconRefresh","MWXIconStrict.react","MessengerCheckmark.svg.react","QPLUserFlow","SVGIcon","mwPushToast","react","react-compiler-runtime","useCreateEncryptedBackup"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c=e.useRef,d=r("BaseToasterStateManager").getInstance();function m(e){var t=o("react-compiler-runtime").c(14),n=e.backupExists,a=e.onFinish,i=e.onStart,l=c(null),s;t[0]!==i?(s=function(){l.current=p(l),i()},t[0]=i,t[1]=s):s=t[1];var u,d,m;t[2]!==a?(u=function(){a==null||a(o("MWEBPinCodeSetupResult").CodeSetupResult.LABYRINTH_ERROR),l.current=f(l)},d=function(){a==null||a(o("MWEBPinCodeSetupResult").CodeSetupResult.SUCCESS),o("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(r("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_SET_UP_IN_CURRENT_SESSION),l.current=_(l)},m=function(){a==null||a(o("MWEBPinCodeSetupResult").CodeSetupResult.VESTA_ERROR),l.current=f(l)},t[2]=a,t[3]=u,t[4]=d,t[5]=m):(u=t[3],d=t[4],m=t[5]);var g;t[6]!==n||t[7]!==s||t[8]!==u||t[9]!==d||t[10]!==m?(g={backupExists:n,onInit:s,onLabyrinthError:u,onSuccess:d,onVestaError:m},t[6]=n,t[7]=s,t[8]=u,t[9]=d,t[10]=m,t[11]=g):g=t[11];var h=r("useCreateEncryptedBackup")(g),y;return t[12]!==h?(y={onPinCodeSetup:h,showErrorToast:function(){l.current=f(l)},showInProgressToast:function(){l.current=p(l)}},t[12]=h,t[13]=y):y=t[13],y}function p(e){if(e.current!=null)return e.current;var t=3600*24*1e3;return r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"pin_code_creation_begin_toast"),o("mwPushToast").mwPushToast({icon:{comet:u.jsx(r("MWXIconStrict.react"),{icon:r("MWXIconRefresh"),size:20}),mds:r("MWXIconRefresh").originalComponent},title:s._(/*BTDS*/"Creating your PIN\u2026")},t)}function _(e){return g(e),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"pin_code_creation_success_toast"),o("mwPushToast").mwPushToast({icon:{comet:u.jsx(r("FDSIcon.react"),{icon:r("FDSCheckmarkCircleFilled24Icon")}),mds:o("SVGIcon").svgIcon(r("MessengerCheckmark.svg.react"))},testid:"mw-encrypted-backups-pin-code-created-toast",title:s._(/*BTDS*/"PIN created")})}function f(e){return g(e),r("QPLUserFlow").addPoint(o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"pin_code_creation_failed_toast"),o("mwPushToast").mwPushErrorToast({body:s._(/*BTDS*/"Failed to create PIN. Try again.")})}function g(e){e.current!=null&&(d.expire(e.current),e.current=null)}l.default=m}),226);
__d("MWEBOnboardingConfirmPINJewelStep.react",["fbt","MWChatEncryptedBackupsPINInterstitialIcon.react","MWChatEncryptedBackupsPinCodeConfirmStepContentWrapper.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsUpsellJewelChatTabLayout.react","MWEBPinCodeSize","MWXCircleButton.react","MWXColumn.react","MWXColumnItem.react","MWXIconArrowLeft","MWXText.react","promiseDone","react","react-compiler-runtime","useEncryptedBackupsQplImpressionRef","useMWChatEncryptedBackupsNumericCode","useMWChatEncryptedBackupsOnPinCodeSetup","xplatToDOMRef"],(function(t,n,r,o,a,i,l,s){"use strict";var e,u=e||(e=o("react")),c="eb-onboarding-confirm-pin-dialog-step";function d(e){var t=o("react-compiler-runtime").c(37),n=e.enteredPinCode,a=e.onComplete,i=e.onReturn,l=e.setIsMismatchError,d=e.subtitle,m=e.title,p=r("useEncryptedBackupsQplImpressionRef")(o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"ONBOARDING_EB_PIN_CONFIRM_STEP_IMPRESSION"),_;t[0]!==a?(_={backupExists:!1,onStart:a},t[0]=a,t[1]=_):_=t[1];var f=r("useMWChatEncryptedBackupsOnPinCodeSetup")(_),g=f.onPinCodeSetup,h;t[2]!==i||t[3]!==l?(h=function(){l(!0),i()},t[2]=i,t[3]=l,t[4]=h):h=t[4];var y;t[5]!==n||t[6]!==h?(y={onCodeMismatch:h,previouslyInsertedCode:n},t[5]=n,t[6]=h,t[7]=y):y=t[7];var C;t[8]!==g?(C=function(t){r("promiseDone")(g(t,o("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent))},t[8]=g,t[9]=C):C=t[9];var b;t[10]!==y||t[11]!==C?(b={checkPreviouslyInsertedCode:y,focusRegionId:c,inputSize:o("MWEBPinCodeSize").EB_PIN_CODE_SIZE,onComplete:C,type:"pin"},t[10]=y,t[11]=C,t[12]=b):b=t[12];var v=o("useMWChatEncryptedBackupsNumericCode").useMWChatEncryptedBackupsNumericCode(b),S=v[0],R=v[1],L=R.invalidKeyPressedError,E;t[13]===Symbol.for("react.memo_cache_sentinel")?(E=s._(/*BTDS*/"Back"),t[13]=E):E=t[13];var k;t[14]!==i?(k={align:"start",item:u.jsx(r("MWXCircleButton.react"),{"aria-label":E,color:"primary",icon:r("MWXIconArrowLeft"),onPress:i,size:32})},t[14]=i,t[15]=k):k=t[15];var I;t[16]!==p?(I=o("xplatToDOMRef").xplatToDOMRef(p),t[16]=p,t[17]=I):I=t[17];var T;t[18]===Symbol.for("react.memo_cache_sentinel")?(T=u.jsx(r("MWXColumnItem.react"),{children:u.jsx(r("MWChatEncryptedBackupsPINInterstitialIcon.react"),{})}),t[18]=T):T=t[18];var D;t[19]===Symbol.for("react.memo_cache_sentinel")?(D={className:"x78zum5 x141feeh"},t[19]=D):D=t[19];var x;t[20]===Symbol.for("react.memo_cache_sentinel")?(x={className:"xpvyfi4 x3ajldb"},t[20]=x):x=t[20];var $;t[21]!==m?($=u.jsx(r("MWXColumnItem.react"),{paddingHorizontal:20,paddingTop:20,children:u.jsx("div",babelHelpers.extends({},D,{children:u.jsx(r("MWXColumnItem.react"),{paddingHorizontal:20,paddingTop:8,verticalAlign:"bottom",children:u.jsx("div",babelHelpers.extends({},x,{children:u.jsx(r("MWXText.react"),{align:"center",isSemanticHeading:!0,type:"headlineEmphasized2",children:m})}))})}))}),t[21]=m,t[22]=$):$=t[22];var P;t[23]!==d?(P=u.jsx(r("MWXColumnItem.react"),{align:"center",paddingHorizontal:16,paddingTop:20,children:u.jsx(r("MWXColumnItem.react"),{paddingVertical:12,children:u.jsx(r("MWXText.react"),{align:"center",color:"secondary",type:"body3",children:d})})}),t[23]=d,t[24]=P):P=t[24];var N;t[25]!==S||t[26]!==L?(N=u.jsx(r("MWXColumnItem.react"),{paddingTop:20,children:u.jsx(r("MWXColumnItem.react"),{align:"center",paddingTop:8,children:u.jsx(r("MWChatEncryptedBackupsPinCodeConfirmStepContentWrapper.react"),babelHelpers.extends({error:L,isMessenger:!1},S,{inputSize:"small"}))})}),t[25]=S,t[26]=L,t[27]=N):N=t[27];var M;t[28]===Symbol.for("react.memo_cache_sentinel")?(M=u.jsx(r("MWXColumn.react"),{paddingVertical:20,children:u.jsx(r("MWXColumnItem.react"),{paddingTop:12,children:u.jsx("div",{className:"xx9tyur"})})}),t[28]=M):M=t[28];var w;t[29]!==$||t[30]!==P||t[31]!==N||t[32]!==I?(w=u.jsxs(r("MWXColumn.react"),{align:"center",paddingHorizontal:16,ref:I,children:[T,$,P,N,M]}),t[29]=$,t[30]=P,t[31]=N,t[32]=I,t[33]=w):w=t[33];var A;return t[34]!==w||t[35]!==k?(A=u.jsx(r("MWChatEncryptedBackupsUpsellJewelChatTabLayout.react"),{size:"large",topItem:k,children:w}),t[34]=w,t[35]=k,t[36]=A):A=t[36],A}l.default=d}),226);
__d("MWFDSRefresh.svg.react",["cr:21756"],(function(t,n,r,o,a,i,l){"use strict";l.default=n("cr:21756")}),98);
__d("VestaDeleteAccountMutation_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="24472846029024529"}),null);
__d("VestaDeleteAccountMutation.graphql",["VestaDeleteAccountMutation_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{kind:"Variable",name:"delete_account_request",variableName:"input"}],r={alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VestaDeleteAccountMutation",selections:[{alias:null,args:t,concreteType:"VestaDeleteAccountResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_delete_account",plural:!1,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"useMWChatEncryptedBackupsVestaUserInfo_viewer"},{alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"hsm_virtual_device",plural:!1,selections:[r],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VestaDeleteAccountMutation",selections:[{alias:null,args:t,concreteType:"VestaDeleteAccountResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_delete_account",plural:!1,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"VestaGetUserInfoResponse",kind:"LinkedField",name:"vesta_user_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_registered",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"login_timeout_remaining_secs",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"hsm_virtual_device",plural:!1,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:n("VestaDeleteAccountMutation_facebookRelayOperation"),metadata:{},name:"VestaDeleteAccountMutation",operationKind:"mutation",text:null}}})();a.exports=e}),null);
__d("VestaDeleteAccount",["CometRelay","VestaDeleteAccountMutation.graphql"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var r=t.clientId,a=t.environment,i=t.optimisticUpdater,l=t.productUseCase,s=t.updater,u=e!==void 0?e:e=n("VestaDeleteAccountMutation.graphql");return o("CometRelay").commitMutation(a,{mutation:u,optimisticUpdater:i,updater:s,variables:{input:{fbid:r,product_use_case:l,vesta_client_api_version:6}}})}l.vestaDeleteAccount=s}),98);
__d("VestaServerGraphQLRegisterProviderBeginRegisterMutation_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="9596958053703216"}),null);
__d("VestaServerGraphQLRegisterProviderBeginRegisterMutation.graphql",["VestaServerGraphQLRegisterProviderBeginRegisterMutation_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{alias:null,args:[{kind:"Variable",name:"begin_register_request",variableName:"input"}],concreteType:"VestaBeginRegisterResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_begin_register",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_r2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_challenge",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_r2_sig",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VestaServerGraphQLRegisterProviderBeginRegisterMutation",selections:t,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VestaServerGraphQLRegisterProviderBeginRegisterMutation",selections:t},params:{id:n("VestaServerGraphQLRegisterProviderBeginRegisterMutation_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLRegisterProviderBeginRegisterMutation",operationKind:"mutation",text:null}}})();a.exports=e}),null);
__d("VestaServerGraphQLRegisterProviderFinishRegisterMutation_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="24657038213948849"}),null);
__d("VestaServerGraphQLRegisterProviderFinishRegisterMutation.graphql",["VestaServerGraphQLRegisterProviderFinishRegisterMutation_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],t=[{kind:"Variable",name:"finish_register_request",variableName:"input"}],r={alias:null,args:null,kind:"ScalarField",name:"register_success",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VestaServerGraphQLRegisterProviderFinishRegisterMutation",selections:[{alias:null,args:t,concreteType:"VestaFinishRegisterResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_finish_register",plural:!1,selections:[r,{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"useMWChatEncryptedBackupsVestaUserInfo_viewer"},{alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"hsm_virtual_device",plural:!1,selections:[o],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VestaServerGraphQLRegisterProviderFinishRegisterMutation",selections:[{alias:null,args:t,concreteType:"VestaFinishRegisterResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_finish_register",plural:!1,selections:[r,{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"VestaGetUserInfoResponse",kind:"LinkedField",name:"vesta_user_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_registered",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"login_timeout_remaining_secs",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"hsm_virtual_device",plural:!1,selections:[o,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:n("VestaServerGraphQLRegisterProviderFinishRegisterMutation_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLRegisterProviderFinishRegisterMutation",operationKind:"mutation",text:null}}})();a.exports=e}),null);
__d("VestaServerGraphQLRegisterProviderInitQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="10088892487810238"}),null);
__d("VestaServerGraphQLRegisterProviderInitQuery.graphql",["VestaServerGraphQLRegisterProviderInitQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"request"}],t=[{alias:null,args:[{kind:"Variable",name:"vesta_init_request",variableName:"request"}],concreteType:"VestaInitIqResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_register_init",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_rsa_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_rsa_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_ed25519_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_ed25519_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_registered",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VestaServerGraphQLRegisterProviderInitQuery",selections:t,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VestaServerGraphQLRegisterProviderInitQuery",selections:t},params:{id:n("VestaServerGraphQLRegisterProviderInitQuery_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLRegisterProviderInitQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("VestaServerGraphQLRegisterProvider",["E2EEBackupUtil","RelayHooks","RelayModern","VestaServerGraphQLRegisterProviderBeginRegisterMutation.graphql","VestaServerGraphQLRegisterProviderFinishRegisterMutation.graphql","VestaServerGraphQLRegisterProviderInitQuery.graphql"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u;async function c(t,r){var a=r.environment,i=await o("RelayHooks").fetchQuery(a,e!==void 0?e:e=n("VestaServerGraphQLRegisterProviderInitQuery.graphql"),{request:{fbid:t.clientId,product_use_case:t.productUseCase,vesta_client_api_version:6}}).toPromise(),l=i==null?void 0:i.fbid_based_auth_layer_vesta_register_init,s=l==null?void 0:l.base64url_encoded_island_rsa_pub,u=l==null?void 0:l.base64url_encoded_island_rsa_pub_signature,c=l==null?void 0:l.base64url_encoded_opaque_pub,d=l==null?void 0:l.base64url_encoded_opaque_pub_signature,m=l==null?void 0:l.base64url_encoded_island_ed25519_pub,p=l==null?void 0:l.base64url_encoded_island_ed25519_pub_signature,_=l==null?void 0:l.is_registered,f=l==null?void 0:l.attempts_remaining;if(s!=null&&u!=null&&c!=null&&d!=null&&m!=null&&p!=null&&_!=null){var g;return{islandRsaPub:(g=o("E2EEBackupUtil")).decodeBase64Url(s),islandRsaPubSig:g.decodeBase64Url(u),opaquePub:g.decodeBase64Url(c),opaquePubSig:g.decodeBase64Url(d),islandEd25519Pub:g.decodeBase64Url(m),islandEd25519PubSig:g.decodeBase64Url(p),isRegistered:_,loginAttemptsRemaining:f}}throw new Error("GraphQL Response is Null")}function d(e,t){var r=t.environment,a=s!==void 0?s:s=n("VestaServerGraphQLRegisterProviderBeginRegisterMutation.graphql"),i={input:{base64url_encoded_opaque_r1:o("E2EEBackupUtil").encodeBase64Url(e.opaqueR1),fbid:e.clientId,product_use_case:e.productUseCase,vesta_client_api_version:6}};return new Promise(function(e,t){o("RelayModern").commitMutation(r,{mutation:a,variables:i,onCompleted:function(r){var n=r.fbid_based_auth_layer_vesta_begin_register,a=n==null?void 0:n.base64url_encoded_opaque_r2,i=n==null?void 0:n.base64url_encoded_opaque_challenge,l=n==null?void 0:n.base64url_encoded_opaque_r2_sig;if(a!=null&&i!=null&&l!=null){e({opaqueR2:o("E2EEBackupUtil").decodeBase64Url(a),opaqueChallenge:o("E2EEBackupUtil").decodeBase64Url(i),opaqueR2Sig:o("E2EEBackupUtil").decodeBase64Url(l)});return}t(new Error("GraphQL Response is Null"))},onError:function(n){t(n)}})})}function m(e,t){var r=t.environment,a=t.updater;return new Promise(function(t,i){o("RelayModern").commitMutation(r,{mutation:u!==void 0?u:u=n("VestaServerGraphQLRegisterProviderFinishRegisterMutation.graphql"),variables:{input:{base64url_encoded_enc_reg_payload:o("E2EEBackupUtil").encodeBase64Url(e.encRegPayload),fbid:e.clientId,product_use_case:e.productUseCase,vesta_client_api_version:6}},onCompleted:function(n){var e,r=(e=n.fbid_based_auth_layer_vesta_finish_register)==null?void 0:e.register_success;if(r!=null){t({registerSuccess:r});return}i(new Error("GraphQL Response is Null"))},onError:function(t){i(t)},updater:a})})}l.initRegister=c,l.beginRegister=d,l.finishRegister=m}),98);